{"version":3,"file":"markdownItAnchor.modern.js","sources":["../permalink.js","../index.js"],"sourcesContent":["let emittedWarning = false\n\nconst position = {\n  false: 'push',\n  true: 'unshift',\n  after: 'push',\n  before: 'unshift'\n}\n\nexport function legacy (slug, opts, state, idx) {\n  if (!emittedWarning) {\n    const warningText = 'Using deprecated markdown-it-anchor permalink option, see https://github.com/valeriangalliat/markdown-it-anchor#todo-anchor-or-file'\n\n    if (process && process.emitWarning) {\n      process.emitWarning(warningText)\n    } else {\n      console.warn(warningText)\n    }\n\n    emittedWarning = true\n  }\n\n  const linkTokens = [\n    Object.assign(new state.Token('link_open', 'a', 1), {\n      attrs: [\n        ...(opts.permalinkClass ? [['class', opts.permalinkClass]] : []),\n        ['href', opts.permalinkHref(slug, state)],\n        ...Object.entries(opts.permalinkAttrs(slug, state))\n      ]\n    }),\n    Object.assign(new state.Token('html_block', '', 0), { content: opts.permalinkSymbol }),\n    new state.Token('link_close', 'a', -1)\n  ]\n\n  if (opts.permalinkSpace) {\n    state.tokens[idx + 1].children[position[opts.permalinkBefore]](Object.assign(new state.Token('text', '', 0), { content: ' ' }))\n  }\n\n  state.tokens[idx + 1].children[position[opts.permalinkBefore]](...linkTokens)\n}\n\nexport function renderHref (slug) {\n  return `#${slug}`\n}\n\nexport function renderAttrs (slug) {\n  return {}\n}\n\nconst commonDefaults = {\n  class: 'header-anchor',\n  renderHref,\n  renderAttrs,\n  symbol: '#'\n}\n\nexport function makePermalink (wrappedRenderPermalink) {\n  function renderPermalink (opts) {\n    opts = Object.assign({}, renderPermalink.defaults, opts)\n\n    return (slug, anchorOpts, state, idx) => {\n      return wrappedRenderPermalink(slug, opts, anchorOpts, state, idx)\n    }\n  }\n\n  renderPermalink.defaults = Object.assign({}, commonDefaults)\n\n  return renderPermalink\n}\n\nexport const ariaHidden = makePermalink((slug, opts, anchorOpts, state, idx) => {\n  const linkTokens = [\n    Object.assign(new state.Token('link_open', 'a', 1), {\n      attrs: [\n        ...(opts.class ? [['class', opts.class]] : []),\n        ['href', opts.renderHref(slug, state)],\n        ['aria-hidden', 'true'],\n        ...Object.entries(opts.renderAttrs(slug, state))\n      ]\n    }),\n    Object.assign(new state.Token('text', '', 0), { content: opts.symbol }),\n    new state.Token('link_close', 'a', -1)\n  ]\n\n  if (opts.space) {\n    state.tokens[idx + 1].children[position[opts.placement]](Object.assign(new state.Token('text', '', 0), { content: ' ' }))\n  }\n\n  state.tokens[idx + 1].children[position[opts.placement]](...linkTokens)\n})\n\nObject.assign(ariaHidden.defaults, {\n  space: true,\n  placement: 'after'\n})\n\nexport const headerLink = makePermalink((slug, opts, anchorOpts, state, idx) => {\n  const linkTokens = [\n    Object.assign(new state.Token('link_open', 'a', 1), {\n      attrs: [\n        ...(opts.class ? [['class', opts.class]] : []),\n        ['href', opts.renderHref(slug, state)],\n        ...Object.entries(opts.renderAttrs(slug, state))\n      ]\n    }),\n    ...state.tokens[idx + 1].children,\n    new state.Token('link_close', 'a', -1)\n  ]\n\n  state.tokens[idx + 1] = Object.assign(new state.Token('inline', '', 0), {\n    children: linkTokens\n  })\n})\n\nexport const linkAfterHeader = makePermalink((slug, opts, anchorOpts, state, idx) => {\n  if (!['visually-hidden', 'aria-label', 'aria-describedby'].includes(opts.style)) {\n    throw new Error(`\\`permalink.linkAfterHeader\\` called with unknown style option \\`${opts.style}\\``)\n  }\n\n  if (opts.style !== 'aria-describedby' && !opts.assistiveText) {\n    throw new Error(`\\`permalink.linkAfterHeader\\` called without the \\`assistiveText\\` option in \\`${opts.style}\\` style`)\n  }\n\n  if (opts.style === 'visually-hidden' && !opts.visuallyHiddenClass) {\n    throw new Error('`permalink.linkAfterHeader` called without the `visuallyHiddenClass` option in `visually-hidden` style')\n  }\n\n  const title = state.tokens[idx + 1]\n    .children\n    .filter(token => token.type === 'text' || token.type === 'code_inline')\n    .reduce((acc, t) => acc + t.content, '')\n\n  const subLinkTokens = []\n  const linkAttrs = []\n\n  if (opts.class) {\n    linkAttrs.push(['class', opts.class])\n  }\n\n  linkAttrs.push(['href', opts.renderHref(slug, state)])\n  linkAttrs.push(...Object.entries(opts.renderAttrs(slug, state)))\n\n  if (opts.style === 'visually-hidden') {\n    subLinkTokens.push(\n      Object.assign(new state.Token('span_open', 'span', 1), {\n        attrs: [['class', opts.visuallyHiddenClass]],\n      }),\n      Object.assign(new state.Token('text', '', 0), {\n        content: opts.assistiveText(title)\n      }),\n      new state.Token('span_close', 'span', -1)\n    )\n\n    if (opts.space) {\n      subLinkTokens[position[opts.placement]](Object.assign(new state.Token('text', '', 0), { content: ' ' }))\n    }\n\n    subLinkTokens[position[opts.placement]](\n      Object.assign(new state.Token('span_open', 'span', 1), {\n        attrs: [['aria-hidden', 'true']],\n      }),\n      Object.assign(new state.Token('text', '', 0), {\n        content: opts.symbol,\n      }),\n      new state.Token('span_close', 'span', -1)\n    )\n  } else {\n    subLinkTokens.push(\n      Object.assign(new state.Token('text', '', 0), {\n        content: opts.symbol,\n      })\n    )\n  }\n\n  if (opts.style === 'aria-label') {\n    linkAttrs.push(['aria-label', opts.assistiveText(title)])\n  } else if (opts.style === 'aria-describedby') {\n    linkAttrs.push(['aria-describedby', slug])\n  }\n\n  const linkTokens = [\n    Object.assign(new state.Token('paragraph_open', 'p', 1), {\n      attrs: [\n        ...(opts.paragraphClass ? [['class', opts.paragraphClass]] : [])\n      ],\n      block: true\n    }),\n    Object.assign(new state.Token('inline', '', 0), {\n      children: [\n        Object.assign(new state.Token('link_open', 'a', 1), {\n          attrs: linkAttrs\n        }),\n        ...subLinkTokens,\n        new state.Token('link_close', 'a', -1),\n      ]\n    }),\n    Object.assign(new state.Token('paragraph_close', 'p', -1), {\n      block: true\n    })\n  ]\n\n  state.tokens.splice(idx + 3, 0, ...linkTokens)\n})\n\nObject.assign(linkAfterHeader.defaults, {\n  style: 'visually-hidden',\n  space: true,\n  placement: 'after'\n})\n","import * as permalink from './permalink'\n\nconst slugify = (s) => encodeURIComponent(String(s).trim().toLowerCase().replace(/\\s+/g, '-'))\n\nfunction uniqueSlug (slug, slugs, failOnNonUnique, startIndex) {\n  let uniq = slug\n  let i = startIndex\n\n  if (failOnNonUnique && Object.prototype.hasOwnProperty.call(slugs, uniq)) {\n    throw new Error(`User defined \\`id\\` attribute \\`${slug}\\` is not unique. Please fix it in your Markdown to continue.`)\n  } else {\n    while (Object.prototype.hasOwnProperty.call(slugs, uniq)) {\n      uniq = `${slug}-${i}`\n      i += 1\n    }\n  }\n\n  slugs[uniq] = true\n\n  return uniq\n}\n\nconst isLevelSelectedNumber = selection => level => level >= selection\nconst isLevelSelectedArray = selection => level => selection.includes(level)\n\nfunction anchor (md, opts) {\n  opts = Object.assign({}, anchor.defaults, opts)\n\n  md.core.ruler.push('anchor', state => {\n    const slugs = {}\n    const tokens = state.tokens\n\n    const isLevelSelected = Array.isArray(opts.level)\n      ? isLevelSelectedArray(opts.level)\n      : isLevelSelectedNumber(opts.level)\n\n    tokens.forEach((token, i) => {\n      if (token.type !== 'heading_open') {\n        return\n      }\n\n      if (!isLevelSelected(Number(token.tag.substr(1)))) {\n        return\n      }\n\n      // Aggregate the next token children text.\n      const title = tokens[i + 1]\n        .children\n        .filter(token => token.type === 'text' || token.type === 'code_inline')\n        .reduce((acc, t) => acc + t.content, '')\n\n      let slug = token.attrGet('id')\n\n      if (slug == null) {\n        slug = uniqueSlug(opts.slugify(title), slugs, false, opts.uniqueSlugStartIndex)\n      } else {\n        slug = uniqueSlug(slug, slugs, true, opts.uniqueSlugStartIndex)\n      }\n\n      token.attrSet('id', slug)\n\n      if (typeof opts.permalink === 'function') {\n        opts.permalink(slug, opts, state, i)\n      } else if (opts.permalink) {\n        opts.renderPermalink(slug, opts, state, i)\n      } else if (opts.renderPermalink && opts.renderPermalink !== permalink.legacy) {\n        opts.renderPermalink(slug, opts, state, i)\n      }\n\n      if (opts.callback) {\n        opts.callback(token, { slug, title })\n      }\n    })\n  })\n}\n\nanchor.permalink = permalink\n\nanchor.defaults = {\n  level: 1,\n  slugify,\n  uniqueSlugStartIndex: 1,\n\n  // Legacy options.\n  permalink: false,\n  renderPermalink: permalink.legacy,\n  permalinkClass: permalink.ariaHidden.defaults.class,\n  permalinkSpace: permalink.ariaHidden.defaults.space,\n  permalinkSymbol: permalink.ariaHidden.defaults.symbol,\n  permalinkBefore: permalink.ariaHidden.defaults.placement === 'before',\n  permalinkHref: permalink.ariaHidden.defaults.renderHref,\n  permalinkAttrs: permalink.ariaHidden.defaults.renderAttrs\n}\n\nexport default anchor\n"],"names":["emittedWarning","position","false","true","after","before","legacy","slug","opts","state","idx","warningText","process","emitWarning","console","warn","linkTokens","Object","assign","Token","attrs","permalinkClass","permalinkHref","entries","permalinkAttrs","content","permalinkSymbol","permalinkSpace","tokens","children","permalinkBefore","renderHref","renderAttrs","commonDefaults","class","symbol","makePermalink","wrappedRenderPermalink","renderPermalink","defaults","anchorOpts","ariaHidden","space","placement","headerLink","linkAfterHeader","includes","style","Error","assistiveText","visuallyHiddenClass","title","filter","token","type","reduce","acc","t","subLinkTokens","linkAttrs","push","paragraphClass","block","splice","uniqueSlug","slugs","failOnNonUnique","startIndex","uniq","i","prototype","hasOwnProperty","call","anchor","md","core","ruler","isLevelSelected","Array","isArray","level","selection","isLevelSelectedNumber","forEach","Number","tag","substr","attrGet","slugify","uniqueSlugStartIndex","attrSet","permalink","callback","s","encodeURIComponent","String","trim","toLowerCase","replace"],"mappings":"AAAA,IAAIA,GAAiB,EAErB,MAAMC,EAAW,CACfC,MAAO,OACPC,KAAM,UACNC,MAAO,OACPC,OAAQ,oBAGMC,EAAQC,EAAMC,EAAMC,EAAOC,GACzC,IAAKV,EAAgB,CACnB,MAAMW,EAAc,sIAEhBC,SAAWA,QAAQC,YACrBD,QAAQC,YAAYF,GAEpBG,QAAQC,KAAKJ,GAGfX,GAAiB,EAGnB,MAAMgB,EAAa,CACjBC,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,IAAK,GAAI,CAClDC,MAAO,IACDZ,EAAKa,eAAiB,CAAC,CAAC,QAASb,EAAKa,iBAAmB,GAC7D,CAAC,OAAQb,EAAKc,cAAcf,EAAME,OAC/BQ,OAAOM,QAAQf,EAAKgB,eAAejB,EAAME,OAGhDQ,OAAOC,OAAO,IAAIT,EAAMU,MAAM,aAAc,GAAI,GAAI,CAAEM,QAASjB,EAAKkB,kBACpE,IAAIjB,EAAMU,MAAM,aAAc,KAAM,IAGlCX,EAAKmB,gBACPlB,EAAMmB,OAAOlB,EAAM,GAAGmB,SAAS5B,EAASO,EAAKsB,kBAAkBb,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAAEM,QAAS,OAG1HhB,EAAMmB,OAAOlB,EAAM,GAAGmB,SAAS5B,EAASO,EAAKsB,qBAAqBd,YAGpDe,EAAYxB,GAC1B,MAAQ,IAAGA,WAGGyB,EAAazB,GAC3B,MAAO,GAGT,MAAM0B,EAAiB,CACrBC,MAAO,gBACPH,WAAAA,EACAC,YAAAA,EACAG,OAAQ,cAGMC,EAAeC,GAC7B,SAASC,EAAiB9B,GAGxB,OAFAA,EAAOS,OAAOC,OAAO,GAAIoB,EAAgBC,SAAU/B,GAE5C,CAACD,EAAMiC,EAAY/B,EAAOC,IACxB2B,EAAuB9B,EAAMC,EAAMgC,EAAY/B,EAAOC,GAMjE,OAFA4B,EAAgBC,SAAWtB,OAAOC,OAAO,GAAIe,GAEtCK,QAGIG,EAAaL,EAAc,CAAC7B,EAAMC,EAAMgC,EAAY/B,EAAOC,KACtE,MAAMM,EAAa,CACjBC,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,IAAK,GAAI,CAClDC,MAAO,IACDZ,EAAK0B,MAAQ,CAAC,CAAC,QAAS1B,EAAK0B,QAAU,GAC3C,CAAC,OAAQ1B,EAAKuB,WAAWxB,EAAME,IAC/B,CAAC,cAAe,WACbQ,OAAOM,QAAQf,EAAKwB,YAAYzB,EAAME,OAG7CQ,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAAEM,QAASjB,EAAK2B,SAC9D,IAAI1B,EAAMU,MAAM,aAAc,KAAM,IAGlCX,EAAKkC,OACPjC,EAAMmB,OAAOlB,EAAM,GAAGmB,SAAS5B,EAASO,EAAKmC,YAAY1B,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAAEM,QAAS,OAGpHhB,EAAMmB,OAAOlB,EAAM,GAAGmB,SAAS5B,EAASO,EAAKmC,eAAe3B,KAG9DC,OAAOC,OAAOuB,EAAWF,SAAU,CACjCG,OAAO,EACPC,UAAW,gBAGAC,EAAaR,EAAc,CAAC7B,EAAMC,EAAMgC,EAAY/B,EAAOC,KACtE,MAAMM,EAAa,CACjBC,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,IAAK,GAAI,CAClDC,MAAO,IACDZ,EAAK0B,MAAQ,CAAC,CAAC,QAAS1B,EAAK0B,QAAU,GAC3C,CAAC,OAAQ1B,EAAKuB,WAAWxB,EAAME,OAC5BQ,OAAOM,QAAQf,EAAKwB,YAAYzB,EAAME,UAG1CA,EAAMmB,OAAOlB,EAAM,GAAGmB,SACzB,IAAIpB,EAAMU,MAAM,aAAc,KAAM,IAGtCV,EAAMmB,OAAOlB,EAAM,GAAKO,OAAOC,OAAO,IAAIT,EAAMU,MAAM,SAAU,GAAI,GAAI,CACtEU,SAAUb,MAID6B,EAAkBT,EAAc,CAAC7B,EAAMC,EAAMgC,EAAY/B,EAAOC,KAC3E,IAAK,CAAC,kBAAmB,aAAc,oBAAoBoC,SAAStC,EAAKuC,OACvE,UAAUC,MAAO,oEAAmExC,EAAKuC,WAG3F,GAAmB,qBAAfvC,EAAKuC,QAAiCvC,EAAKyC,cAC7C,UAAUD,MAAO,kFAAiFxC,EAAKuC,iBAGzG,GAAmB,oBAAfvC,EAAKuC,QAAgCvC,EAAK0C,oBAC5C,UAAUF,MAAM,0GAGlB,MAAMG,EAAQ1C,EAAMmB,OAAOlB,EAAM,GAC9BmB,SACAuB,OAAOC,GAAwB,SAAfA,EAAMC,MAAkC,gBAAfD,EAAMC,MAC/CC,OAAO,CAACC,EAAKC,IAAMD,EAAMC,EAAEhC,QAAS,IAEjCiC,EAAgB,GAChBC,EAAY,GAEdnD,EAAK0B,OACPyB,EAAUC,KAAK,CAAC,QAASpD,EAAK0B,QAGhCyB,EAAUC,KAAK,CAAC,OAAQpD,EAAKuB,WAAWxB,EAAME,KAC9CkD,EAAUC,QAAQ3C,OAAOM,QAAQf,EAAKwB,YAAYzB,EAAME,KAErC,oBAAfD,EAAKuC,OACPW,EAAcE,KACZ3C,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,OAAQ,GAAI,CACrDC,MAAO,CAAC,CAAC,QAASZ,EAAK0C,wBAEzBjC,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAC5CM,QAASjB,EAAKyC,cAAcE,KAE9B,IAAI1C,EAAMU,MAAM,aAAc,QAAS,IAGrCX,EAAKkC,OACPgB,EAAczD,EAASO,EAAKmC,YAAY1B,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAAEM,QAAS,OAGnGiC,EAAczD,EAASO,EAAKmC,YAC1B1B,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,OAAQ,GAAI,CACrDC,MAAO,CAAC,CAAC,cAAe,WAE1BH,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAC5CM,QAASjB,EAAK2B,SAEhB,IAAI1B,EAAMU,MAAM,aAAc,QAAS,KAGzCuC,EAAcE,KACZ3C,OAAOC,OAAO,IAAIT,EAAMU,MAAM,OAAQ,GAAI,GAAI,CAC5CM,QAASjB,EAAK2B,UAKD,eAAf3B,EAAKuC,MACPY,EAAUC,KAAK,CAAC,aAAcpD,EAAKyC,cAAcE,KACzB,qBAAf3C,EAAKuC,OACdY,EAAUC,KAAK,CAAC,mBAAoBrD,IAGtC,MAAMS,EAAa,CACjBC,OAAOC,OAAO,IAAIT,EAAMU,MAAM,iBAAkB,IAAK,GAAI,CACvDC,MAAO,IACDZ,EAAKqD,eAAiB,CAAC,CAAC,QAASrD,EAAKqD,iBAAmB,IAE/DC,OAAO,IAET7C,OAAOC,OAAO,IAAIT,EAAMU,MAAM,SAAU,GAAI,GAAI,CAC9CU,SAAU,CACRZ,OAAOC,OAAO,IAAIT,EAAMU,MAAM,YAAa,IAAK,GAAI,CAClDC,MAAOuC,OAEND,EACH,IAAIjD,EAAMU,MAAM,aAAc,KAAM,MAGxCF,OAAOC,OAAO,IAAIT,EAAMU,MAAM,kBAAmB,KAAM,GAAI,CACzD2C,OAAO,KAIXrD,EAAMmB,OAAOmC,OAAOrD,EAAM,EAAG,KAAMM,KCrMrC,SAASgD,EAAYzD,EAAM0D,EAAOC,EAAiBC,GACjD,IAAIC,EAAO7D,EACP8D,EAAIF,EAER,GAAID,GAAmBjD,OAAOqD,UAAUC,eAAeC,KAAKP,EAAOG,GACjE,UAAUpB,MAAO,mCAAkCzC,kEAEnD,KAAOU,OAAOqD,UAAUC,eAAeC,KAAKP,EAAOG,IACjDA,EAAQ,GAAE7D,KAAQ8D,IAClBA,GAAK,EAMT,OAFAJ,EAAMG,IAAQ,EAEPA,EAMT,SAASK,EAAQC,EAAIlE,GACnBA,EAAOS,OAAOC,OAAO,GAAIuD,EAAOlC,SAAU/B,GAE1CkE,EAAGC,KAAKC,MAAMhB,KAAK,SAAUnD,IAC3B,MAAMwD,EAAQ,GACRrC,EAASnB,EAAMmB,OAEfiD,EAAkBC,MAAMC,QAAQvE,EAAKwE,QATlBC,EAUAzE,EAAKwE,MAVQA,GAASC,EAAUnC,SAASkC,IADxCC,CAAAA,GAAaD,GAASA,GAASC,EAYrDC,CAAsB1E,EAAKwE,OAXNC,IAAAA,EAazBrD,EAAOuD,QAAQ,CAAC9B,EAAOgB,KACrB,GAAmB,iBAAfhB,EAAMC,KACR,OAGF,IAAKuB,EAAgBO,OAAO/B,EAAMgC,IAAIC,OAAO,KAC3C,OAIF,MAAMnC,EAAQvB,EAAOyC,EAAI,GACtBxC,SACAuB,OAAOC,GAAwB,SAAfA,EAAMC,MAAkC,gBAAfD,EAAMC,MAC/CC,OAAO,CAACC,EAAKC,IAAMD,EAAMC,EAAEhC,QAAS,IAEvC,IAAIlB,EAAO8C,EAAMkC,QAAQ,MAGvBhF,EADU,MAARA,EACKyD,EAAWxD,EAAKgF,QAAQrC,GAAQc,GAAO,EAAOzD,EAAKiF,sBAEnDzB,EAAWzD,EAAM0D,GAAO,EAAMzD,EAAKiF,sBAG5CpC,EAAMqC,QAAQ,KAAMnF,GAEU,mBAAnBC,EAAKmF,UACdnF,EAAKmF,UAAUpF,EAAMC,EAAMC,EAAO4D,IACzB7D,EAAKmF,WAELnF,EAAK8B,iBAAmB9B,EAAK8B,kBAAoBqD,IAD1DnF,EAAK8B,gBAAgB/B,EAAMC,EAAMC,EAAO4D,GAKtC7D,EAAKoF,UACPpF,EAAKoF,SAASvC,EAAO,CAAE9C,KAAAA,EAAM4C,MAAAA,QDsIrClC,OAAOC,OAAO2B,EAAgBN,SAAU,CACtCQ,MAAO,kBACPL,OAAO,EACPC,UAAW,UCnIb8B,EAAOkB,2HAEPlB,EAAOlC,SAAW,CAChByC,MAAO,EACPQ,QA9EeK,GAAMC,mBAAmBC,OAAOF,GAAGG,OAAOC,cAAcC,QAAQ,OAAQ,MA+EvFT,qBAAsB,EAGtBE,WAAW,EACXrD,gBAAiBqD,EACjBtE,eAAgBsE,EAAqBpD,SAASL,MAC9CP,eAAgBgE,EAAqBpD,SAASG,MAC9ChB,gBAAiBiE,EAAqBpD,SAASJ,OAC/CL,gBAA6D,WAA5C6D,EAAqBpD,SAASI,UAC/CrB,cAAeqE,EAAqBpD,SAASR,WAC7CP,eAAgBmE,EAAqBpD,SAASP"}